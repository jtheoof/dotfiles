#!/usr/bin/env bash

if [ $# -ne 1 ]; then
    echo "Need 1 argument (up, down, toggle)"
    exit 1;
fi


current_volume() {
  pamixer --get-volume
}

muted() {
  pamixer --get-mute
}

volume_up() {
  if [[ $(( $(current_volume) + 5 )) -ge 100 ]]; then
    pactl set-sink-mute @DEFAULT_SINK@ 0 && pactl set-sink-volume @DEFAULT_SINK@ 100%
  else
    pactl set-sink-mute @DEFAULT_SINK@ 0 && pactl set-sink-volume @DEFAULT_SINK@ +5%
  fi
}

volume_down() {
  if [[ $(( $(current_volume) - 5 )) -le 0 ]]; then
    pactl set-sink-mute @DEFAULT_SINK@ 0 && pactl set-sink-volume @DEFAULT_SINK@ 0%
  else
    pactl set-sink-mute @DEFAULT_SINK@ 0 && pactl set-sink-volume @DEFAULT_SINK@ -5%
  fi
}

volume_toggle_mute() {
  pactl set-sink-mute @DEFAULT_SINK@ toggle
}

send_notification() {
  volume=$(current_volume)
  muted=$(muted)
  iconpath=/usr/share/icons/Papirus-Dark/symbolic/status/
  ext=svg
  icon=$iconpath/audio-volume-low-symbolic.$ext

  if [ "$muted" = "true" ]; then
    icon=$iconpath/audio-volume-muted-symbolic.$ext
  elif [ $volume -ge 0 ] && [ $volume -le 33 ]; then
    icon=$iconpath/audio-volume-low-symbolic.$ext
  elif [ $volume -ge 33 ] && [ $volume -le 66 ]; then
    icon=$iconpath/audio-volume-medium-symbolic.$ext
  elif [ $volume -ge 66 ]; then
    icon=$iconpath/audio-volume-high-symbolic.$ext
  fi

  makoctl dismiss --all && \
  notify-send -i $icon --hint=int:transient:1 --hint=int:value:$volume --hint=string:synchronous:volume " "
}

if [ $1 = 'up' ]; then
  volume_up
elif [ $1 = 'down' ]; then
  volume_down
elif [ $1 = 'toggle' ]; then
  volume_toggle_mute
fi


send_notification

XDG_RUNTIME_DIR=/run/user/1000 paplay /usr/share/sounds/freedesktop/stereo/bell.oga


