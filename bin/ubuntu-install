#!/bin/bash

GITPATH=$HOME/dev/me/config

function install_ppa() {
#	sudo add-apt-repository ppa:bumblebee/stable # Bumblebee
    echo "installing ppas"
	sudo add-apt-repository ppa:tualatrix/ppa # Ubuntu Tweak
	sudo add-apt-repository ppa:tiheum/equinox # Faenza icons
	sudo add-apt-repository ppa:caffeine-developers/ppa # Caffeine

    echo "updating apt repository database"
	sudo apt-get update
}

function install_packages() {
    echo "installing default packages"
	# Ubuntu
	sudo apt-get install -y gnome-tweak-tool ubuntu-tweak faenza-icon-theme \
 	   	caffeine synapse
#	sudo apt-get install -y bumblebee
	# Editors
	sudo apt-get install -y vim-gnome exuberant-ctags
	# Shell
	sudo apt-get install -y tree ack-grep zsh terminator tilda
	# Compiz
	sudo apt-get install -y compizconfig-settings-manager compiz-plugins-extra
	# Programming
	sudo apt-get install -y python ruby build-essential ant
	# Graphics
	sudo apt-get install -y gcolor2 colordiff
	# VCS
	sudo apt-get install -y git tig subversion mercurial
	# Networking
	sudo apt-get install -y curl socat
	# Scripting
#	sudo apt-get install -y python-django python-mysqldb mysql-server
}

function config_zsh() {
    olddir=$PWD
    cd $HOME
    echo "fetching oh-my-zsh"
    wget --no-check-certificate https://github.com/robbyrussell/oh-my-zsh/raw/master/tools/install.sh -O - | sh
    for i in $HOME/dev/me/config/files/.config/zsh/themes/*; do
        echo "linking theme: $i"
        basename $i
        ln -s $i $HOME/.oh-my-zsh/themes/$(basename $i)
    done
    cp $HOME/dev/me/config/files/.config/zsh/themes/* $HOME/.oh-my-zsh/themes/
    echo "changing default shell to /bin/zsh"
    chsh -s /bin/zsh
    cd $olddir
}

function config_sudoers() {
    echo "configuring /etc/sudoers"
    sudo sed -i 's/\(^Defaults\(\s\+\)env_reset\)/\1\nDefaults\2timestamp_timeout=-1/g' /etc/sudoers
}

# TODO Factorize link creation to a function
# to handle existing links.
function make_links() {
    FILESPATH=$GITPATH/files
    for i in ./.zsh_*; do
        echo "linking config file: $i"
        ln -s $FILESPATH/$i $HOME/$i
    done
    for i in ./.*rc; do
        echo "linking config file: $i"
        ln -s $FILESPATH/$i $HOME/$i
    done
    echo "linking .vim"
    ln -s $FILESPATH/.vim $HOME/.vim
    echo "linking .dircolors"
    ln -s $FILESPATH/.dircolors.ansi-dark $HOME/.dircolors
    echo "linking .gitconfig"
    ln -s $FILESPATH/.gitconfig $HOME/.gitconfig

    # Terminator config
    if [ ! -d $HOME/.config/terminator ]; then
        mkdir -p $HOME/.config/terminator
    elif [ -f $HOME/.config/terminator/config ]; then
        rm $HOME/.config/terminator/config
    fi
    echo "linking terminator config"
    ln -s $FILESPATH/.config/terminator/config $HOME/.config/terminator/config
}

install_ppa
install_packages
config_zsh
config_sudoers
make_links
